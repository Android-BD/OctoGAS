<script>
  var muterBox;
  var lablerBox;

  function installMuterTrigger() {
    muterBox.className = "installing";
    google.script.run.
      withSuccessHandler(function (){
        muterBox.className = "installed";
      }).
      installTrigger("muter");
  }

  function uninstallMuterTrigger() {
    muterBox.className = "uninstalling";
    google.script.run.
      withSuccessHandler(function (){
        muterBox.className = "uninstalled";
      }).
      uninstallTrigger("muter");
  }

  function installLablerTrigger() {
    lablerBox.className = "installing";
    google.script.run.
      withSuccessHandler(function (){
        lablerBox.className = "installed";
      }).
      installTrigger("labler");
  }

  function uninstallLablerTrigger() {
    lablerBox.className = "uninstalling";
    google.script.run.
      withSuccessHandler(function (){
        lablerBox.className = "uninstalled";
      }).
      uninstallTrigger("labler");
  }

  function resetGitHubAuthorization() {
    google.script.run.
      withSuccessHandler(function (){
        lablerBox.className = "not-authorized";
      }).
      resetGitHubAuthorization();
  }

  window.onload = function (){
    muterBox = document.querySelector("#muter-box");
    lablerBox = document.querySelector("#labler-box");
  }

</script>

<style>
  body, * {
    font-family: menlo, monospace;
  }

  body {
    line-height: 1.6em;
    min-height: 100%;
    padding: 30px;
    background-color: #7FD36C;
    color: #fff;
    font-size: 13px;
    text-align: center;
  }

  .page-title {
    font-weight: 300;
    font-size: 40px;
    margin: 0 0 30px;
    display: inline-block;
    line-height: 1em;
    border-bottom: 1px solid #fff;
  }

  .wrapper {
    text-align: left;
    width: 420px;
    margin: 30px auto;
  }

  h2 {
    text-align: center;
  }

  #muter-box .state {
    display: none;
  }

  #muter-box.installed .state.installed {
    display: block;
  }

  #muter-box.uninstalled .state.uninstalled {
    display: block;
  }

  #muter-box.installing .state.installing {
    display: block;
  }

  #muter-box.uninstalling .state.uninstalling {
    display: block;
  }

  #muter-box.installing button:before {
     content: "Installing muter..."
  }

  #muter-box.uninstalling button:before {
     content: "Uninstalling muter..."
  }

  #muter-box.uninstalled button:before {
     content: "Install  +"
  }

  #muter-box.installed button:before {
    content: "×  Uninstall"
  }

  #labler-box .state {
    display: none;
  }

  #labler-box.installed .state.installed {
    display: block;
  }

  #labler-box.uninstalled .state.uninstalled {
    display: block;
  }

  #labler-box.uninstalling .state.uninstalling {
    display: block;
  }

  #labler-box.installing .state.installing {
    display: block;
  }

  #labler-box.not-authorized .state.not-authorized {
    display: block;
  }

  #labler-box.installed button:before, #labler-box.uninstalled button:before {
    content: "Reset GitHub Authorization"
  }

  #labler-box.installing button:before {
     content: "Installing labler..."
  }

  #labler-box.uninstalling button:before {
     content: "Uninstalling labler..."
  }

  #labler-box.uninstalled button:before {
     content: "Install  +"
  }

  #labler-box.installed button:before {
    content: "×  Uninstall"
  }

  div.state-box {
    text-align: center;
    font-size: 12px;
    color: #f9f9f9;
  }

  button, a.button {
    border: 3px solid #71c45e;
    color: #71c45e;
    background: #fff;
    text-align: center;
    display: block;
    padding: 12px 19px;
    margin: 30px auto 0;
    font-weight: bold;
    text-transform: uppercase;
    cursor: pointer;
    border-radius: 5px;
    letter-spacing: 1px;
  }

  button:hover, a.button:hover {
    border-color: #61b44e;
  }

  button:active, a.button:active {
    box-shadow: 0 3px 2px rgba(0,0,0,.08);
    padding-top: 13px;
    padding-bottom: 11px;
  }

</style>
<h1 class="page-title">OctoGAS</h1>

<div class="wrapper">
  <div id="muter-box" class="<?= muterState ?>">
    <h2>Muter</h2>
    <p>This script checks your inbox for muted threads from GitHub. It makes a request to unsubscribe you from the GitHub issue or pull request and unmutes the Gmail conversation. That way, if you are <code>@mentioned</code> again, you will be re-subscribed to the thread.</p>


    <div id="install" class="state uninstalled">
      <button onclick="installMuterTrigger()"></button>
    </div>

    <div class="state installing uninstalling">
      <button></button>
    </div>

    <div id="uninstall" class="state installed">
      <button onclick="uninstallMuterTrigger()"></button>
    </div>

    <div class="state-box">
      <span class="state installed">Muter is installed.</span>
      <span class="state uninstalled">Muter is not installed.</span>
      <span class="state installing uninstalling">&nbsp;</span>
    </div>
  </div>
</div>

<div class="wrapper">
  <div id="labler-box" class="<?= lablerState ?>">
    <h2>Labler</h2>
    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat..</p>

    <div class="state not-authorized">
      <p>You need to authorize this app with your GitHub account before installing Labler. This will allow us to get a list of your GitHub teams, so we know how to create labels for team <code>@mentions</code>.</p>
      <a class="button" href="<?= githubService.getAuthorizationUrl() ?>">Authorize with GitHub</a>
    </div>

    <div id="install" class="state uninstalled">
      <button onclick="installLablerTrigger()"></button>
    </div>

    <div class="state installing uninstalling">
      <button></button>
    </div>

    <div id="uninstall" class="state installed">
      <button onclick="uninstallLablerTrigger()"></button>
    </div>

      <div class="state-box">
        <span class="state not-authorized">Not authorized to GitHub.</span>
        <span class="state uninstalled">Labler is not installed</span>
        <span class="state installed">Labler is installed.</span>
        <span class="state installing uninstalling">&nbsp;</span>
    </div>
  </div>
</div>
